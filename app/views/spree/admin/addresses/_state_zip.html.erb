<%= fields_for :address, @address do |f| %>
  <%= f.field_container :state do %>
    <% if !@address.country.states.present? && @address.country.states_required? %>
      <%= f.text_field :state_name, style: "display: #{ @address.country.states.empty? && @address.country.states_required? ? 'block' : 'none' };", required: true %>
    <% end %>

    <% if @address.country.states.present? %>
      <%= f.collection_select :state_id, @address.country.states.sort, :id, :name, { include_blank: true }, {class: 'form-select', required: @address.country.states_required?, data: { controller: @address.country.states.empty? ? '' : 'ts--select'}} %>
    <% end %>

    <% if @address.country.states_required? || @address.country.states.present? %>
      <% if @address.country.states_required? %>
        <%= f.label :state_id, raw(state_label(@address.country) + required_span_tag) %>
      <% else %>
        <%= f.label :state_id, state_label(@address.country) %>
      <% end %>
    <% end %>
  <% end %>

  <%= f.field_container :zipcode do %>
    <%= f.text_field :zipcode, required: @address.country.zipcode_required? %>

    <% if @address.country.zipcode_required? %>
      <%= f.label :zipcode, (raw(zipcode_label(@address.country)) + required_span_tag) %>
    <% else %>
      <%= f.label :zipcode, zipcode_label(@address.country) %>
    <% end %>
  <% end %>
<% end %>
