<% content_for :page_title do %>
  <%= breadcrumb_builder(link_one_uri: spree.admin_users_path, link_one_text: I18n.t('spree.admin.users.users'), current_page_name: @user.email) %>
<% end %>

<% content_for :page_actions do %>
  <%= link_to_with_icon Spree.t(:create_new_order), spree.new_admin_order_path(user_id: @user.id), class: "btn-primary btn", icon: 'plus-square.svg' if can?(:create, Spree::Order) %>
<% end %>

<div class="row">
  <div class="col-12 col-md-8">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title"><%= I18n.t('spree.admin.user.stats') %></h5>
      </div>
      <div class="card-body">
        <%= render 'lifetime_stats' %>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h5 class="card-title">
          <%= Spree.t(:general_settings) %>
        </h5>
      </div>

      <div class="card-body">
        <div data-hook="admin_user_edit_form">
          <%= form_with model: [:admin, @user] do |f| %>
            <%= render partial: 'form', locals: { f: f } %>

            <div data-hook="admin_user_edit_form_button">
              <%= render partial: 'spree/admin/shared/resource_actions', locals: { collection_url: spree.admin_users_url } %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-4">
    <div class="card">
      <div class="card-header d-flex">
        <div class="flex-fill">
          <h5 class="card-title">
            <%= I18n.t('spree.admin.user.customer') %>
          </h5>
        </div>
        <div>
          <%= link_to I18n.t('spree.admin.actions.edit'), spree.addresses_admin_user_path(@user), class: "btn btn-sm btn-outline-secondary" %>
        </div>
      </div>

      <div class="card-body">
        <%= @user.first_name %> <%= @user.last_name %><br>
        <%= @user.email %>
        <div>
        <% @user.spree_roles.each do |role| %>
          <span class="badge bg-secondary"><%= role.name %></span>
        <% end %>
        </div>
      </div>

      <hr>

      <div class="card-body">
        <div class="d-flex">
          <div class="flex-fill">
            <% if @user.bill_address == @user.ship_address %>
              <h5 class="card-title"><%= I18n.t('spree.admin.user.default_address') %></h5>
              <small class="text-muted">Used for Billing and Shipping</small>
            <% else %>
              <h5 class="card-title"><%= I18n.t('spree.admin.user.default_addresses') %></h5>
            <% end %>
          </div>
          <div>
            <%= link_to I18n.t('spree.admin.users.manage'), spree.addresses_admin_user_path(@user), class: "btn btn-sm btn-outline-secondary" %>
          </div>
        </div>

        <% if @user.bill_address.present? %>
         <% unless @user.bill_address == @user.ship_address %>
           <h6><%= I18n.t('spree.admin.user.billing_addresses') %></h6>
         <% end %>
         <div>
           <% if @user.bill_address.label.present? %>
             <h6><span class="badge bg-secondary"><%= @user.bill_address.label %></span></h6>
           <% end %>
           <span class="text-muted"><%= I18n.t('spree.admin.user.name') %>:</span> <%= @user.bill_address.full_name %><br>
           <% if @user.bill_address.company.present? %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.company') %>:</span> <%= @user.bill_address.company %><br>
           <% end %>
           <span class="text-muted"><%= I18n.t('spree.admin.user.street') %>:</span> <%= @user.bill_address.address1 %><br>
           <% if @user.bill_address.address2.present? %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.address2') %>:</span> <%= @user.bill_address.address2 %><br>
           <% end %>
           <span class="text-muted"><%= I18n.t('spree.admin.user.city') %>:</span> <%= @user.bill_address.city %><br>
           <% if @user.bill_address.state.present? %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.state') %>:</span> <%= @user.bill_address.state %><br>
           <% end %>
           <% if @user.bill_address.zipcode.present? %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.zip_code') %>:</span> <%= @user.bill_address.zipcode %><br>
           <% end %>
           <span class="text-muted"><%= I18n.t('spree.admin.user.country') %>:</span> <%= @user.bill_address.country %>
           <% if @user.bill_address.phone.present? %>
             <br>
             <span class="text-muted"><%= I18n.t('spree.admin.user.phone') %>:</span> <%= @user.bill_address.phone %><br>
           <% end %>
         </div>
        <% end %>

        <% unless @user.bill_address == @user.ship_address %>
         <hr>
        <% end %>

        <% unless @user.bill_address == @user.ship_address %>
         <% if @user.ship_address.present? %>
         <h6><%= I18n.t('spree.admin.user.shipping_addresses') %></h6>
           <div>
             <% if @user.ship_address.label.present? %>
               <h6><span class="badge bg-secondary"><%= @user.ship_address.label %></span></h6>
             <% end %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.name') %>:</span> <%= @user.ship_address.full_name %><br>
             <% if @user.ship_address.company.present? %>
               <span class="text-muted"><%= I18n.t('spree.admin.user.company') %>:</span> <%= @user.ship_address.company %><br>
             <% end %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.street') %>:</span> <%= @user.ship_address.address1 %><br>
             <% if @user.ship_address.address2.present? %>
               <span class="text-muted"><%= I18n.t('spree.admin.user.address2') %>:</span> <%= @user.ship_address.address2 %><br>
             <% end %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.city') %>:</span> <%= @user.ship_address.city %><br>
             <% if @user.ship_address.state.present? %>
               <span class="text-muted"><%= I18n.t('spree.admin.user.state') %>:</span> <%= @user.ship_address.state %><br>
             <% end %>
             <% if @user.ship_address.zipcode.present? %>
               <span class="text-muted"><%= I18n.t('spree.admin.user.zip_code') %>:</span> <%= @user.ship_address.zipcode %><br>
             <% end %>
             <span class="text-muted"><%= I18n.t('spree.admin.user.country') %>:</span> <%= @user.ship_address.country %>
             <% if @user.ship_address.phone.present? %>
               <br>
               <span class="text-muted"><%= I18n.t('spree.admin.user.phone') %>:</span> <%= @user.ship_address.phone %><br>
             <% end %>
           </div>
         <% end %>
        <% end %>
      </div>
    </div>
  </div>
</div>
